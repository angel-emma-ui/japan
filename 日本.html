<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬è¡Œ 2026 | äº¤é€šèˆ‡è¡Œç¨‹æ‰‹å†Š</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;500;700&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --primary-pink: #c89696;
            --accent-green: #a5b59a;
            --accent-blue: #8fa9b5;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --text-main: #545e62;
            --sidebar-width: 280px; /* æ‰‹æ©Ÿç‰ˆç•¥ç‚ºç¸®æ¸› */
        }
        body { 
            background-color: var(--bg-color); color: var(--text-main); 
            font-family: 'M PLUS Rounded 1c', 'Noto Sans TC', sans-serif; 
            margin: 0; overflow: hidden; font-size: 1rem; /* é è¨­ç¸®å° */
            background-image: radial-gradient(at 10% 10%, rgba(200, 150, 150, 0.2) 0px, transparent 50%),
                              radial-gradient(at 90% 10%, rgba(165, 181, 154, 0.15) 0px, transparent 50%),
                              radial-gradient(at 50% 50%, rgba(230, 220, 208, 0.3) 0px, transparent 50%),
                              radial-gradient(at 90% 90%, rgba(200, 150, 150, 0.2) 0px, transparent 50%);
            background-size: cover; background-attachment: fixed;
        }

        /* éŸ¿æ‡‰å¼å­—é«”èª¿æ•´ */
        @media (min-width: 600px) {
            body { font-size: 1.1rem; }
            :root { --sidebar-width: 320px; }
        }

        header { position: fixed; top: 0; width: 100%; height: 75px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(15px); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.4); }
        .header-center-title { font-size: 1.8rem; font-weight: 700; color: var(--primary-pink); letter-spacing: 5px; }
        @media (min-width: 600px) {
            header { height: 85px; }
            .header-center-title { font-size: 2.2rem; letter-spacing: 8px; }
        }

        .menu-btn { position: fixed; top: 18px; left: 15px; background: var(--glass-bg); border: none; border-radius: 12px; padding: 8px; cursor: pointer; z-index: 3000; box-shadow: 2px 2px 8px rgba(0,0,0,0.08); display: flex; align-items: center; }
        @media (min-width: 600px) { .menu-btn { top: 25px; padding: 10px; border-radius: 15px; } }
        
        .sidebar { position: fixed; left: calc(-1 * var(--sidebar-width) - 20px); top: 0; width: var(--sidebar-width); height: 100%; background: white; z-index: 2000; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding-top: 100px; box-shadow: 5px 0 25px rgba(0,0,0,0.05); }
        .sidebar.active { transform: translateX(calc(var(--sidebar-width) + 20px)); }
        .sidebar-item { padding: 20px 30px; display: block; text-decoration: none; color: var(--text-main); font-size: 1.3rem; border-left: 6px solid transparent; cursor: pointer; }
        .sidebar-item.current { background: #fdf2f2; border-left-color: var(--primary-pink); color: var(--primary-pink); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.15); display: none; z-index: 1999; }
        .overlay.active { display: block; }

        .page-container { height: 100vh; padding: 110px 15px 60px 15px; box-sizing: border-box; display: none; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .page-container.active { display: block; animation: slideUp 0.5s ease; }
        @media (min-width: 600px) { .page-container { padding: 140px 20px 60px 20px; } }

        /* å¤©æ°£ä¸‰æ¬„éŸ¿æ‡‰å¼èª¿æ•´ */
        .weather-banner { 
            background: linear-gradient(135deg, rgba(253, 242, 242, 0.6) 0%, rgba(232, 240, 235, 0.5) 100%); 
            border-radius: 25px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.3); display: flex; flex-direction: row; align-items: center; gap: 10px;
        }
        .w-col-left { flex: 1.2; border-right: 1.5px solid rgba(200, 150, 150, 0.2); padding-right: 10px; }
        .w-col-mid { flex: 1; border-right: 1.5px solid rgba(200, 150, 150, 0.2); padding: 0 10px; display: flex; flex-direction: column; gap: 4px; font-size: 0.95rem; font-weight: 700; }
        .w-col-right { flex: 1.3; padding-left: 10px; line-height: 1.4; font-size: 0.9rem; }
        
        .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 25px; padding: 18px; box-shadow: 10px 10px 30px rgba(0,0,0,0.03); margin-bottom: 20px; border-top: 6px solid var(--accent-green); }

        /* ä½µæ’å€å¡Šåˆ‡æ›ï¼šæ‰‹æ©Ÿå †ç–Šï¼Œå¹³æ¿ä»¥ä¸Šä½µæ’ */
        .home-dual-row { display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
        @media (min-width: 480px) {
            .home-dual-row { display: grid; grid-template-columns: 1fr 1fr; }
        }
        .home-dual-row .glass-card { margin-bottom: 0; }

        .flight-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .flight-box { background: rgba(255,255,255,0.5); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.3); text-align: left; }
        .flight-title { font-weight: 700; color: var(--primary-pink); margin-bottom: 8px; font-size: 1rem; border-bottom: 1.5px solid rgba(200, 150, 150, 0.2); padding-bottom: 5px; }
        .flight-info-row { font-size: 0.85rem; margin-bottom: 4px; display: flex; justify-content: flex-start; gap: 8px; }
        .flight-label { color: #888; min-width: 35px; flex-shrink: 0; }
        
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .custom-input { flex: 1; min-width: 80px; padding: 12px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.05); outline: none; font-family: inherit; font-size: 1rem; background: rgba(255,255,255,0.8); }
        .action-btn { padding: 12px 20px; background: var(--primary-pink); color: white; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 1rem; width: 100%; transition: 0.2s; }
        .action-btn:active { transform: scale(0.97); background: #b88686; }

        .list-card { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.6); padding: 15px; border-radius: 20px; margin-bottom: 10px; border-left: 5px solid var(--accent-green); font-size: 0.95rem; }
        .del-btn { color: #ff9a9a; border: none; background: none; font-weight: 700; font-size: 1.2rem; cursor: pointer; padding: 5px; }

        .transport-accordion, .home-accordion, .itinerary-accordion { margin-bottom: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 22px; overflow: hidden; border: 1px solid #eee; }
        .accordion-header { padding: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.1rem; }
        .accordion-content { display: none; padding: 15px; background: white; border-top: 1px solid #f9f9f9; }
        .accordion-content.active { display: block; animation: fadeIn 0.3s ease; }
        
        .transport-btn { display: inline-block; width: calc(50% - 5px); text-align: center; padding: 12px 5px; border-radius: 12px; text-decoration: none; font-weight: 700; margin-bottom: 10px; color: white; font-size: 0.85rem; }
        .btn-timetable { background: var(--primary-pink); }
        .btn-routemap { background: var(--accent-green); }
        .btn-airport { background: #6b8fb3; }

        .metro-embed-container { border-radius: 15px; overflow: hidden; border: 2px solid #4a90e2; margin-top: 10px; -webkit-overflow-scrolling: touch; }
        .metro-embed-container iframe { width: 100%; height: 400px; border: none; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .currency-label { font-size: 1rem; color: #666; font-weight: 500; margin-bottom: 4px; display: block; }
        .exchange-rate-row { background: rgba(143,169,181,0.08); padding: 8px; border-radius: 12px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .exchange-rate-text { font-size: 1rem; color: #888; }
        .exchange-rate-input { width: 55px; border: none; background: transparent; font-size: 1rem; color: var(--text-main); font-weight: 700; outline: none; text-align: center; border-bottom: 1.5px solid rgba(0,0,0,0.1); }
    </style>
</head>
<body>
    <button class="menu-btn" onclick="toggleMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#c89696" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
    <header><div class="header-center-title">æ—¥æœ¬è¡Œ</div></header>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-item current" onclick="showPage('home')">ğŸ  é¦–é æ¦‚è¦½</div>
        <div class="sidebar-item" onclick="showPage('itinerary')">ğŸŒ¸ æ¯æ—¥è¡Œç¨‹</div>
        <div class="sidebar-item" onclick="showPage('expenses')">ğŸ’° å…±æœ‰è¨˜å¸³</div>
        <div class="sidebar-item" onclick="showPage('map')">ğŸ“ æ™¯é»æœå°‹</div>
        <div class="sidebar-item" onclick="showPage('transport')">ğŸš† äº¤é€šå·¥å…·</div>
    </div>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <!-- é¦–é  -->
    <div id="home" class="page-container active" style="padding-bottom: 120px;">
        <div style="text-align: center; margin-bottom: 20px;">
            <h1 style="color: var(--primary-pink); margin: 0; font-size: 2.2rem; font-weight: 700;">Kansai 2026</h1>
            <p id="currentDate" style="color: #abb6ba; margin-top: 5px; font-size: 1.1rem;"></p>
        </div>

        <div class="weather-banner">
            <div class="w-col-left">
                <p style="font-size: 2.5rem; font-weight: 700; color: var(--primary-pink); margin: 0;" id="tempMain">--Â°</p>
                <p style="margin: 2px 0 0 0; font-size: 0.9rem; font-weight: 500;" id="weatherDesc">é€£ç·šä¸­</p>
            </div>
            <div class="w-col-mid">
                <div>é«˜ <span id="tempMax">--</span></div>
                <div>ä½ <span id="tempMin">--</span></div>
            </div>
            <div class="w-col-right">
                <div style="color:var(--primary-pink); font-weight:700; margin-bottom:2px;">æ°£è±¡æé†’</div>
                <div id="weatherAlerts">è®€å–ä¸­...</div>
            </div>
        </div>

        <div class="home-accordion" style="border-top: 6px solid var(--primary-pink);">
            <div class="accordion-header" onclick="toggleAcc(this)" style="color: var(--primary-pink);">âœˆï¸ èˆªç­è³‡è¨Š <span>â–¼</span></div>
            <div class="accordion-content">
                <div class="flight-grid">
                    <div class="flight-box">
                        <div class="flight-title">ğŸ›« GK 54</div>
                        <div class="flight-info-row"><span class="flight-label">æ—¥:</span><span>4/11 (å…­)</span></div>
                        <div class="flight-info-row"><span class="flight-label">æ™‚:</span><span>18:10-21:40</span></div>
                        <div class="flight-info-row"><span class="flight-label">ç«™:</span><span>T1</span></div>
                    </div>
                    <div class="flight-box">
                        <div class="flight-title">ğŸ›¬ GK 57</div>
                        <div class="flight-info-row"><span class="flight-label">æ—¥:</span><span>4/16 (å››)</span></div>
                        <div class="flight-info-row"><span class="flight-label">æ™‚:</span><span>23:35-01:30</span></div>
                        <div class="flight-info-row"><span class="flight-label">ç«™:</span><span>T1</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-card" style="border-top-color: var(--primary-pink);">
            <h4 style="margin-top: 0; color: var(--primary-pink); font-size: 1.1rem;">ğŸ’¡ æ—…è¡Œå°æé†’</h4>
            <div class="input-group"><input type="text" id="memoInput" class="custom-input" placeholder="æé†’äº‹é …..."><button class="action-btn" onclick="addMemo()" style="width: auto;">æ–°å¢</button></div>
            <ul id="memoList" style="padding:0; list-style:none;"></ul>
        </div>

        <div class="glass-card" style="border-top-color: var(--accent-green);">
            <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.1rem;">ğŸ“ å¿«æ·æ™¯é»æœå°‹</h4>
            <div class="input-group"><input type="text" id="homeSearch" class="custom-input" placeholder="æƒ³å»å“ªè£¡ï¼Ÿ"><button class="action-btn" style="width: auto;" onclick="homeSearchJump()">æœå°‹</button></div>
        </div>

        <!-- è¨˜å¸³èˆ‡åŒ¯ç‡ä½µæ’ (RWDç‰ˆ) -->
        <div class="home-dual-row">
            <div class="glass-card" style="border-top-color: var(--accent-green);">
                <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.1rem; margin-bottom: 10px;">ğŸ’¸ è¨˜å¸³</h4>
                <input type="text" id="homeExpItem" class="custom-input" placeholder="é …ç›®" style="margin-bottom: 5px;">
                <input type="number" id="homeExpAmount" class="custom-input" placeholder="é‡‘é¡ (Â¥)" style="margin-bottom: 5px;">
                <select id="homeExpPayer" class="custom-input" style="margin-bottom: 10px;">
                    <option value="æˆ‘">æˆ‘ä»˜</option><option value="æ—…ä¼´">æ—…ä¼´</option>
                </select>
                <button class="action-btn" style="background: var(--accent-green);" onclick="addExpenseHome(this)">ç´€éŒ„</button>
            </div>

            <div class="glass-card" style="border-top-color: var(--accent-blue);">
                <h4 style="margin-top: 0; color: var(--accent-blue); font-size: 1.1rem; margin-bottom: 10px;">ğŸ’± æ›ç®—</h4>
                <div style="margin-bottom: 5px;">
                    <span class="currency-label">æ—¥å¹£ Â¥</span>
                    <input type="number" id="inputJPY" class="custom-input" placeholder="0" oninput="convertCurrency('JPY')" style="width: 100%; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 10px;">
                    <span class="currency-label">å°å¹£ $</span>
                    <input type="number" id="inputTWD" class="custom-input" placeholder="0" oninput="convertCurrency('TWD')" style="width: 100%; box-sizing: border-box;">
                </div>
                <div class="exchange-rate-row">
                    <span class="exchange-rate-text">åŒ¯ç‡:</span>
                    <input type="number" id="exchangeRate" class="exchange-rate-input" value="0.21" step="0.001" oninput="convertCurrency('JPY')">
                </div>
            </div>
        </div>

        <div style="margin-top: 40px;">
            <div class="home-accordion" style="border-top: 6px solid #4a90e2; margin-bottom: 0;">
                <div class="accordion-header" onclick="toggleAcc(this)" style="color: #4a90e2;">ğŸš‡ å¤§é˜ª Metro è·¯ç·šè¦åŠƒ <span>â–¼</span></div>
                <div class="accordion-content">
                    <div class="metro-embed-container"><iframe src="https://metronine.osaka/tw/fullpage-course/" allowfullscreen></iframe></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸŒ¸ æ¯æ—¥è¡Œç¨‹ -->
    <div id="itinerary" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:20px; font-size:2.2rem; font-weight:700;">æ¯æ—¥è¡Œç¨‹</h1>
        <div class="itinerary-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/11 (å…­) Day 1 <span>â–¼</span></div><div class="accordion-content"><p>18:10 é£› GK 54 â” 21:40 æŠµé—œç©º T1ã€‚æ­å—æµ·é›»éµé€²å¸‚å€ä¼‘æ¯ã€‚</p></div></div>
        <div class="itinerary-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/12 (æ—¥) Day 2 <span>â–¼</span></div><div class="accordion-content"><p>äº¬éƒ½è³æ«»ï¼šè¹´ä¸Šå‚¾æ–œéµé“ã€å“²å­¸ä¹‹é“ã€éŠ€é–£å¯ºã€ç¥‡åœ’ã€‚</p></div></div>
        <div class="itinerary-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/13 - 15 <span>â–¼</span></div><div class="accordion-content"><p>å¸‚å€æ¡è²·ã€ç¾é£Ÿè¦åŠƒä¸­...</p></div></div>
        <div class="itinerary-accordion" style="border-bottom: 1px solid #eee;"><div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/16 (å››) Day 6 <span>â–¼</span></div><div class="accordion-content"><p>æœ€å¾Œè¡Œç¨‹ï¼Œ23:35 é—œç©º GK 57 â” 01:30(+1) è¿”å°ã€‚</p></div></div>
    </div>

    <!-- å…±æœ‰è¨˜å¸³ -->
    <div id="expenses" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:20px; font-size:2.2rem; font-weight:700;">å…±æœ‰è¨˜å¸³</h1>
        <div class="glass-card">
            <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.1rem;">â• æ–°å¢æ”¯å‡º</h4>
            <div class="input-group">
                <input type="text" id="tabExpItem" class="custom-input" placeholder="é …ç›®">
                <input type="number" id="tabExpAmount" class="custom-input" placeholder="é‡‘é¡ (Â¥)">
                <select id="tabExpPayer" class="custom-input" style="flex: 0.5;"><option value="æˆ‘">æˆ‘</option><option value="æ—…ä¼´">æ—…ä¼´</option></select>
                <button class="action-btn" style="width: auto;" onclick="addExpenseTab(this)">ç´€éŒ„</button>
            </div>
        </div>
        <div class="glass-card settle-card"><h4 style="margin-top: 0; font-size: 1.1rem;">ğŸ“Š çµç®—å½™æ•´</h4><div id="settlementInfo">è¨ˆç®—ä¸­...</div></div>
        <div id="expenseList" style="padding:0;"></div>
    </div>

    <!-- æ™¯é»æœå°‹ -->
    <div id="map" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:20px; font-size:2.2rem; font-weight:700;">æ™¯é»æœå°‹</h1>
        <div class="glass-card">
            <div class="input-group"><input type="text" id="mapSearch" class="custom-input" placeholder="æœå°‹ç›®çš„åœ°..."><button class="action-btn" style="width: auto;" onclick="mapsJump()">æœå°‹</button></div>
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d104996.63!2d135.41!3d34.67!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6000e6553406e2e1%3A0x23779435411a1318!2z5pel5pys5aSn6Ziq!5e0!3m2!1szh-TW!2stw!4v1700000000000" width="100%" height="400" style="border:0; border-radius:20px;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>

    <!-- äº¤é€šå·¥å…· -->
    <div id="transport" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:20px; font-size:2.2rem; font-weight:700;">äº¤é€šå·¥å…·</h1>
        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">âœˆï¸ å—æµ·é›»éµ (æ©Ÿå ´) <span>â–¼</span></div><div class="accordion-content">
            <a href="https://kensaku.nankai.co.jp/tc/pc/N1" target="_blank" class="transport-btn btn-timetable">æ™‚åˆ»è¡¨</a>
            <a href="https://www.howto-osaka.com/tc/access-timetable/" target="_blank" class="transport-btn btn-airport">æ©Ÿå ´ç™¼è»Š</a>
            <p>é—œç©ºå‰å¾€é›£æ³¢ã€å¿ƒé½‹æ©‹æœ€é€Ÿé¦–é¸ã€‚</p>
        </div></div>
        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸš‡ å¤§é˜ª Metro <span>â–¼</span></div><div class="accordion-content">
            <a href="https://metronine.osaka/tw/line-departure/" target="_blank" class="transport-btn btn-airport">é¦–/æœ«ç­è»Š</a>
            <a href="https://metronine.osaka/tw/fullpage-course/" target="_blank" class="transport-btn btn-routemap">è·¯ç·šåœ–</a>
            <p>å¸‚å€æ ¸å¿ƒï¼Œå¾¡å ‚ç­‹ç·šå¯ç›´é€šå„æ™¯é»ã€‚</p>
        </div></div>
        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸš† JR / é˜ªæ€¥ / äº¬é˜ª <span>â–¼</span></div><div class="accordion-content">
            <a href="https://www.westjr.co.jp/global/tc/timetable/" target="_blank" class="transport-btn btn-timetable">JR æ™‚åˆ»è¡¨</a>
            <a href="https://www.hankyu.co.jp/global/zh-tw/" target="_blank" class="transport-btn btn-routemap">é˜ªæ€¥å®˜ç¶²</a>
            <p>å‰å¾€äº¬éƒ½ã€å¥ˆè‰¯ã€æ–°å¤§é˜ªçš„é•·é€”é¸æ“‡ã€‚</p>
        </div></div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAdafgqoTVQtcRsgdHCBLWKgsrzg8rWy18", authDomain: "japan-1cac5.firebaseapp.com", projectId: "japan-1cac5", storageBucket: "japan-1cac5.firebasestorage.app", messagingSenderId: "673729211706", appId: "1:673729211706:web:4958ffe5ba6d15fac63403", databaseURL: "https://japan-1cac5-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const memoRef = database.ref('memos'), expenseRef = database.ref('expenses');

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
        function showPage(pId) {
            document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
            document.getElementById(pId).classList.add('active');
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('current'));
            const idMap = {'home':0, 'itinerary':1, 'expenses':2, 'map':3, 'transport':4};
            document.getElementById('sidebar').children[idMap[pId]].classList.add('current');
            if (document.getElementById('sidebar').classList.contains('active')) toggleMenu();
        }
        function toggleAcc(h) { const c = h.nextElementSibling; c.classList.toggle('active'); h.querySelector('span').innerText = c.classList.contains('active') ? 'â–²' : 'â–¼'; }
        
        function addMemo() { const i = document.getElementById('memoInput'); if(i.value) { memoRef.push().set({ text: i.value }); i.value = ''; } }
        memoRef.on('value', s => {
            const l = document.getElementById('memoList'); l.innerHTML = '';
            s.forEach(c => { l.innerHTML += `<li class="list-card"><span>${c.val().text}</span><button class="del-btn" onclick="database.ref('memos/${c.key}').remove()">âœ•</button></li>`; });
        });

        function convertCurrency(src) {
            const jpy = document.getElementById('inputJPY'), twd = document.getElementById('inputTWD'), r = parseFloat(document.getElementById('exchangeRate').value) || 0;
            if(src==='JPY') twd.value = jpy.value ? (parseFloat(jpy.value) * r).toFixed(0) : "";
            else jpy.value = twd.value ? (parseFloat(twd.value) / r).toFixed(0) : "";
        }

        function addExpenseHome(b) {
            const item = document.getElementById('homeExpItem').value, amt = document.getElementById('homeExpAmount').value, payer = document.getElementById('homeExpPayer').value;
            if (item && amt) {
                expenseRef.push().set({ item, amt: parseFloat(amt), payer, time: Date.now() });
                document.getElementById('homeExpItem').value = ''; document.getElementById('homeExpAmount').value = '';
                b.innerText = "OK!"; setTimeout(() => b.innerText = "ç´€éŒ„", 1000);
            }
        }
        function addExpenseTab(b) {
            const item = document.getElementById('tabExpItem').value, amt = document.getElementById('tabExpAmount').value, payer = document.getElementById('tabExpPayer').value;
            if (item && amt) {
                expenseRef.push().set({ item, amt: parseFloat(amt), payer, time: Date.now() });
                document.getElementById('tabExpItem').value = ''; document.getElementById('tabExpAmount').value = '';
                b.innerText = "OK!"; setTimeout(() => b.innerText = "ç´€éŒ„", 1000);
            }
        }
        expenseRef.on('value', s => {
            const l = document.getElementById('expenseList'), sb = document.getElementById('settlementInfo');
            l.innerHTML = ''; let me = 0, fr = 0;
            s.forEach(c => {
                const d = c.val(); if(d.payer==="æˆ‘") me+=d.amt; else fr+=d.amt;
                l.innerHTML += `<div class="list-card"><div><strong>${d.item}</strong> Â¥${d.amt} (${d.payer})</div><button class="del-btn" onclick="database.ref('expenses/${c.key}').remove()">âœ•</button></div>`;
            });
            const diff = (me - fr) / 2;
            sb.innerHTML = `<strong>${diff > 0 ? 'æ—…ä¼´æ‡‰ä»˜ä½ ' : (diff < 0 ? 'ä½ æ‡‰ä»˜æ—…ä¼´' : 'å…©æ¸…')}ï¼šÂ¥${Math.abs(diff).toFixed(0)}</strong>`;
        });

        const API_KEY = '02462ec6be3770531a65ab94c8cf93cb';
        async function fetchWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Osaka&appid=${API_KEY}&units=metric&lang=zh_tw`);
                const data = await res.json();
                if(data.cod === "200") {
                    const c = data.list[0];
                    document.getElementById('tempMain').innerText = Math.round(c.main.temp) + 'Â°';
                    document.getElementById('weatherDesc').innerText = c.weather[0].description;
                    document.getElementById('tempMax').innerText = Math.round(c.main.temp_max) + 'Â°';
                    document.getElementById('tempMin').innerText = Math.round(c.main.temp_min) + 'Â°';
                    document.getElementById('weatherAlerts').innerText = c.weather[0].main.toLowerCase().includes('rain') ? "æœ‰é›¨ï¼Œå¸¶å‚˜ â˜”" : "æ°£æº«èˆ’é© âœ¨";
                }
            } catch (e) { console.error("å¤©æ°£å¤±æ•—:", e); }
        }

        window.onload = () => {
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'long' });
            fetchWeather();
        };
        function mapsJump() { const q = document.getElementById('mapSearch').value; if(q) window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank'); }
        function homeSearchJump() { const q = document.getElementById('homeSearch').value; if(q) window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank'); }
    </script>
</body>
</html>
