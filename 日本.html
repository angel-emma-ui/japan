<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ—¥æœ¬è¡Œ 2026 | äº¤é€šèˆ‡è¡Œç¨‹æ‰‹å†Š</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;500;700&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root {
            --bg-color: #f4f7f6;
            --primary-pink: #c89696;
            --accent-green: #a5b59a;
            --accent-blue: #8fa9b5;
            --glass-bg: rgba(255, 255, 255, 0.7);
            --text-main: #545e62;
            --sidebar-width: 280px;
        }
        body { 
            background-color: var(--bg-color); color: var(--text-main); 
            font-family: 'M PLUS Rounded 1c', 'Noto Sans TC', sans-serif; 
            margin: 0; overflow: hidden; font-size: 1rem;
            background-image: radial-gradient(at 10% 10%, rgba(200, 150, 150, 0.2) 0px, transparent 50%),
                              radial-gradient(at 90% 10%, rgba(165, 181, 154, 0.15) 0px, transparent 50%),
                              radial-gradient(at 50% 50%, rgba(230, 220, 208, 0.3) 0px, transparent 50%),
                              radial-gradient(at 90% 90%, rgba(200, 150, 150, 0.2) 0px, transparent 50%);
            background-size: cover; background-attachment: fixed;
        }

        @media (min-width: 600px) {
            body { font-size: 1.1rem; }
            :root { --sidebar-width: 320px; }
        }

        header { position: fixed; top: 0; width: 100%; height: 75px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(15px); z-index: 1000; border-bottom: 1px solid rgba(255,255,255,0.4); }
        .header-center-title { font-size: 1.8rem; font-weight: 700; color: var(--primary-pink); letter-spacing: 5px; }
        @media (min-width: 600px) {
            header { height: 85px; }
            .header-center-title { font-size: 2.2rem; letter-spacing: 8px; }
        }

        .menu-btn { position: fixed; top: 18px; left: 15px; background: var(--glass-bg); border: none; border-radius: 12px; padding: 8px; cursor: pointer; z-index: 3000; box-shadow: 2px 2px 8px rgba(0,0,0,0.08); display: flex; align-items: center; }
        
        .sidebar { position: fixed; left: calc(-1 * var(--sidebar-width) - 20px); top: 0; width: var(--sidebar-width); height: 100%; background: white; z-index: 2000; transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding-top: 100px; box-shadow: 5px 0 25px rgba(0,0,0,0.05); }
        .sidebar.active { transform: translateX(calc(var(--sidebar-width) + 20px)); }
        .sidebar-item { padding: 20px 30px; display: block; text-decoration: none; color: var(--text-main); font-size: 1.3rem; border-left: 6px solid transparent; cursor: pointer; }
        .sidebar-item.current { background: #fdf2f2; border-left-color: var(--primary-pink); color: var(--primary-pink); }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.15); display: none; z-index: 1999; }
        .overlay.active { display: block; }

        .page-container { height: 100vh; padding: 100px 15px 120px 15px; box-sizing: border-box; display: none; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .page-container.active { display: block; animation: slideUp 0.5s ease; }

        /* å¤©æ°£å€å¡Šä¿®å¾© */
        .weather-banner { 
            background: linear-gradient(135deg, rgba(253, 242, 242, 0.6) 0%, rgba(232, 240, 235, 0.5) 100%); 
            border-radius: 25px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.3); display: flex; align-items: center; gap: 10px;
        }
        .w-col-left { flex: 1.2; border-right: 1.5px solid rgba(200, 150, 150, 0.2); padding-right: 10px; }
        .w-col-mid { flex: 1.1; border-right: 1.5px solid rgba(200, 150, 150, 0.2); padding: 0 10px; display: flex; flex-direction: column; gap: 4px; font-weight: 700; font-size: 0.9rem; }
        .w-col-right { flex: 1.3; padding-left: 10px; line-height: 1.4; font-size: 0.9rem; }
        
        .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border-radius: 25px; padding: 20px; box-shadow: 10px 10px 30px rgba(0,0,0,0.03); margin-bottom: 20px; border-top: 6px solid var(--accent-green); }

        .home-dual-row { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        @media (min-width: 500px) {
            .home-dual-row { display: grid; grid-template-columns: 1fr 1fr; }
        }
        .home-dual-row .glass-card { margin-bottom: 0; }

        .flight-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .flight-box { background: rgba(255,255,255,0.5); padding: 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.3); text-align: left; }
        .flight-title { font-weight: 700; color: var(--primary-pink); margin-bottom: 8px; font-size: 1.1rem; border-bottom: 1.5px solid rgba(200, 150, 150, 0.2); padding-bottom: 5px; }
        .flight-info-row { font-size: 0.9rem; margin-bottom: 4px; display: flex; justify-content: flex-start; gap: 10px; }
        .flight-label { color: #888; min-width: 40px; flex-shrink: 0; }
        
        .input-group { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .custom-input { flex: 1; min-width: 100px; padding: 14px; border-radius: 15px; border: 1px solid rgba(0,0,0,0.05); outline: none; font-family: inherit; font-size: 1.1rem; background: rgba(255,255,255,0.8); }
        .action-btn { padding: 12px 20px; background: var(--primary-pink); color: white; border: none; border-radius: 15px; cursor: pointer; font-weight: 700; font-size: 1rem; width: 100%; transition: 0.2s; }
        .action-btn:active { transform: scale(0.96); background: #b88686; }

        .list-card { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.6); padding: 18px; border-radius: 20px; margin-bottom: 12px; border-left: 6px solid var(--accent-green); }
        .del-btn { color: #ff9a9a; border: none; background: none; font-weight: 700; font-size: 1.4rem; cursor: pointer; padding: 5px; }

        .transport-accordion, .home-accordion, .itinerary-accordion { margin-bottom: 15px; background: rgba(255, 255, 255, 0.8); border-radius: 25px; overflow: hidden; border: 1px solid #eee; }
        .accordion-header { padding: 22px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.15rem; }
        .accordion-header:hover { background: #fdf2f2; }
        .accordion-content { display: none; padding: 20px; background: white; border-top: 1px solid #f9f9f9; }
        .accordion-content.active { display: block; animation: fadeIn 0.3s ease; }
        
        .transport-btn { display: inline-block; width: calc(50% - 8px); text-align: center; padding: 15px 5px; border-radius: 15px; text-decoration: none; font-weight: 700; margin-bottom: 12px; color: white; font-size: 0.9rem; }
        .btn-timetable { background: var(--primary-pink); }
        .btn-routemap { background: var(--accent-green); }
        .btn-airport { background: #6b8fb3; }

        .metro-embed-container { border-radius: 20px; overflow: hidden; border: 2px solid #4a90e2; margin-top: 10px; }
        .metro-embed-container iframe { width: 100%; height: 450px; border: none; }
        
        /* åŒ¯ç‡å¤§å­—é«” */
        .currency-label { font-size: 1.1rem; color: #666; font-weight: 500; margin-bottom: 6px; display: block; }
        .exchange-rate-row { background: rgba(143,169,181,0.08); padding: 10px; border-radius: 15px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .exchange-rate-text { font-size: 1.1rem; color: #888; }
        .exchange-rate-input { width: 70px; border: none; background: transparent; font-size: 1.1rem; color: var(--text-main); font-weight: 700; outline: none; text-align: center; border-bottom: 2px solid rgba(0,0,0,0.1); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <button class="menu-btn" onclick="toggleMenu()">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#c89696" stroke-width="2.5"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
    <header><div class="header-center-title">æ—¥æœ¬è¡Œ</div></header>
    
    <div class="sidebar" id="sidebar">
        <div class="sidebar-item current" onclick="showPage('home')">ğŸ  é¦–é æ¦‚è¦½</div>
        <div class="sidebar-item" onclick="showPage('itinerary')">ğŸŒ¸ æ¯æ—¥è¡Œç¨‹</div>
        <div class="sidebar-item" onclick="showPage('expenses')">ğŸ’° å…±æœ‰è¨˜å¸³</div>
        <div class="sidebar-item" onclick="showPage('map')">ğŸ“ æ™¯é»æœå°‹</div>
        <div class="sidebar-item" onclick="showPage('transport')">ğŸš† äº¤é€šå·¥å…·</div>
    </div>
    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <!-- é¦–é  -->
    <div id="home" class="page-container active">
        <div style="text-align: center; margin-bottom: 25px;">
            <h1 style="color: var(--primary-pink); margin: 0; font-size: 2.4rem; font-weight: 700;">Kansai 2026</h1>
            <p id="currentDate" style="color: #abb6ba; margin-top: 5px; font-size: 1.1rem;"></p>
        </div>

        <!-- 1. å¤©æ°£å€å¡Š (å·²ä¿®å¾©é«”æ„Ÿæº«åº¦èˆ‡å°é½Š) -->
        <div class="weather-banner">
            <div class="w-col-left">
                <p style="font-size: 2.8rem; font-weight: 700; color: var(--primary-pink); margin: 0;" id="tempMain">--Â°</p>
                <p style="margin: 2px 0 0 0; font-size: 1rem; font-weight: 500;" id="weatherDesc">é€£ç·šä¸­</p>
            </div>
            <div class="w-col-mid">
                <div style="color: #d68a8a;">æœ€é«˜ <span id="tempMax">--</span></div>
                <div style="color: #8aa9d6;">æœ€ä½ <span id="tempMin">--</span></div>
                <div style="color: #7a888d;">é«”æ„Ÿ <span id="tempFeels">--</span></div>
            </div>
            <div class="w-col-right">
                <div style="color:var(--primary-pink); font-weight:700; margin-bottom:2px;">ä»Šæ—¥æé†’</div>
                <div id="weatherAlerts">æ­£åœ¨è®€å–è³‡æ–™...</div>
            </div>
        </div>

        <!-- 2. èˆªç­ (æ”¶ç´) -->
        <div class="home-accordion" style="border-top: 6px solid var(--primary-pink);">
            <div class="accordion-header" onclick="toggleAcc(this)" style="color: var(--primary-pink);">âœˆï¸ èˆªç­è³‡è¨Š <span>â–¼</span></div>
            <div class="accordion-content">
                <div class="flight-grid">
                    <div class="flight-box">
                        <div class="flight-title">ğŸ›« GK 54</div>
                        <div class="flight-info-row"><span class="flight-label">æ—¥æœŸ:</span><span>4/11 (å…­)</span></div>
                        <div class="flight-info-row"><span class="flight-label">æ™‚é–“:</span><span>18:20-22:00</span></div>
                        <div class="flight-info-row"><span class="flight-label">èˆªå»ˆ:</span><span>TPE T1-KIX T1</span></div>
                    </div>
                    <div class="flight-box">
                        <div class="flight-title">ğŸ›¬ GK 57</div>
                        <div class="flight-info-row"><span class="flight-label">æ—¥æœŸ:</span><span>4/16 (å››)</span></div>
                        <div class="flight-info-row"><span class="flight-label">æ™‚é–“:</span><span>23:35-01:30</span></div>
                        <div class="flight-info-row"><span class="flight-label">èˆªå»ˆ:</span><span>KIX T1-TPE T1</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. æ—…è¡Œå°æé†’ -->
        <div class="glass-card" style="border-top-color: var(--primary-pink);">
            <h4 style="margin-top: 0; color: var(--primary-pink); font-size: 1.2rem;">ğŸ’¡ æ—…è¡Œå°æé†’</h4>
            <div class="input-group"><input type="text" id="memoInput" class="custom-input" placeholder="æé†’æ—…ä¼´ä»€éº¼..."><button class="action-btn" onclick="addMemo()" style="width: auto;">æ–°å¢</button></div>
            <ul id="memoList" style="padding:0; list-style:none; margin:0;"></ul>
        </div>

        <!-- 4. å¿«æ·æ™¯é»æœå°‹ -->
        <div class="glass-card" style="border-top-color: var(--accent-green);">
            <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.1rem;">ğŸ“ å¿«æ·æ™¯é»æœå°‹</h4>
            <div class="input-group"><input type="text" id="homeSearch" class="custom-input" placeholder="æƒ³å»å“ªè£¡ç©ï¼Ÿ"><button class="action-btn" style="width: auto;" onclick="homeSearchJump()">æœå°‹</button></div>
        </div>

        <!-- 5. è¨˜å¸³èˆ‡åŒ¯ç‡ä½µæ’ -->
        <div class="home-dual-row">
            <div class="glass-card" style="border-top-color: var(--accent-green);">
                <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.1rem; margin-bottom: 12px;">ğŸ’¸ è¨˜å¸³</h4>
                <input type="text" id="homeExpItem" class="custom-input" placeholder="é …ç›®" style="margin-bottom: 8px;">
                <input type="number" id="homeExpAmount" class="custom-input" placeholder="é‡‘é¡ (Â¥)" style="margin-bottom: 8px;">
                <select id="homeExpPayer" class="custom-input" style="margin-bottom: 12px;">
                    <option value="é">æˆ‘ä»˜çš„</option><option value="æ—…ä¼´">æ—…ä¼´ä»˜çš„</option>
                </select>
                <button class="action-btn" style="background: var(--accent-green);" onclick="addExpenseHome(this)">ç´€éŒ„</button>
            </div>

            <div class="glass-card" style="border-top-color: var(--accent-blue);">
                <h4 style="margin-top: 0; color: var(--accent-blue); font-size: 1.1rem; margin-bottom: 12px;">ğŸ’± æ›ç®—</h4>
                <div style="margin-bottom: 8px;">
                    <span class="currency-label">æ—¥å¹£ Â¥</span>
                    <input type="number" id="inputJPY" class="custom-input" placeholder="0" oninput="convertCurrency('JPY')" style="width: 100%; box-sizing: border-box;">
                </div>
                <div style="margin-bottom: 12px;">
                    <span class="currency-label">å°å¹£ $</span>
                    <input type="number" id="inputTWD" class="custom-input" placeholder="0" oninput="convertCurrency('TWD')" style="width: 100%; box-sizing: border-box;">
                </div>
                <div class="exchange-rate-row">
                    <span class="exchange-rate-text">åŒ¯ç‡:</span>
                    <input type="number" id="exchangeRate" class="exchange-rate-input" value="0.21" step="0.001" oninput="convertCurrency('JPY')">
                </div>
            </div>
        </div>

        <!-- 6. åœ°éµåœ– -->
        <div style="margin-top: 60px;">
            <div class="home-accordion" style="border-top: 6px solid #4a90e2; margin-bottom: 0;">
                <div class="accordion-header" onclick="toggleAcc(this)" style="color: #4a90e2;">ğŸš‡ å¤§é˜ª Metro è·¯ç·šè¦åŠƒ <span>â–¼</span></div>
                <div class="accordion-content">
                    <div class="metro-embed-container"><iframe src="https://metronine.osaka/tw/fullpage-course/" allowfullscreen></iframe></div>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ†é  1: æ¯æ—¥è¡Œç¨‹ -->
    <div id="itinerary" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:25px; font-size:2.5rem; font-weight:700;">æ¯æ—¥è¡Œç¨‹</h1>
        
        <div class="itinerary-accordion">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/11 (å…­) Day 1 æŠµé” <span>â–¼</span></div>
            <div class="accordion-content">
                <ul>
                    <li>18:10 æ¡ƒåœ’æ©Ÿå ´ GK 54 èµ·é£›</li>
                    <li>21:40 æŠµé”é—œè¥¿æ©Ÿå ´ T1</li>
                    <li>è¾¦ç†å…¥å¢ƒæ‰‹çºŒå¾Œæ­ä¹˜å—æµ·é›»éµ (Rapi:t) å‰å¾€é›£æ³¢/å¿ƒé½‹æ©‹åœ°å€å…¥ä½ä¼‘æ¯ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="itinerary-accordion">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/12 (æ—¥) Day 2 äº¬éƒ½è³æ«» <span>â–¼</span></div>
            <div class="accordion-content">
                <ul>
                    <li>è¹´ä¸Šå‚¾æ–œéµé“ï¼šæ¼«æ­¥åœ¨å»¢æ£„éµé“ä¸Šçš„æ«»èŠ±éš§é“ã€‚</li>
                    <li>å“²å­¸ä¹‹é“ï¼šæ²¿è‘—å°æºªæ•£æ­¥è‡³éŠ€é–£å¯ºï¼Œäº«å—å¯§éœçš„æ«»èŠ±æ°›åœã€‚</li>
                    <li>å—ç¦ªå¯º / ç¥‡åœ’ä¸€å¸¶è§€å…‰ï¼Œé«”é©—äº¬éƒ½æ­·å²é¢¨æƒ…ã€‚</li>
                </ul>
            </div>
        </div>

        <div class="itinerary-accordion">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/13 (ä¸€) Day 3 å¤§é˜ªæ¢ç´¢ <span>â–¼</span></div>
            <div class="accordion-content"><ul><li>å¤§é˜ªåŸå…¬åœ’ï¼šåƒè§€å¤©å®ˆé–£èˆ‡å››å‘¨æ«»èŠ±ã€‚</li><li>æ¢…ç”°å¤§æ¨“çœºæœ›ï¼šä¿¯ç°å¤§é˜ªå¸‚å€é»ƒæ˜èˆ‡å¤œæ™¯ã€‚</li></ul></div>
        </div>

        <div class="itinerary-accordion">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/14 (äºŒ) Day 4 å¥ˆè‰¯é¹¿å¢ƒ <span>â–¼</span></div>
            <div class="accordion-content"><ul><li>å¥ˆè‰¯å…¬åœ’èˆ‡æ±å¤§å¯ºï¼šèˆ‡å¯æ„›çš„å°é¹¿è¿‘è·é›¢æ¥è§¸ã€‚</li><li>èˆˆç¦å¯ºåƒæ‹œã€‚</li></ul></div>
        </div>

        <div class="itinerary-accordion">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/15 (ä¸‰) Day 5 è³¼ç‰©è¡Œç¨‹ <span>â–¼</span></div>
            <div class="accordion-content"><ul><li>é»‘é–€å¸‚å ´å“åšåœ¨åœ°æµ·é®®ã€‚</li><li>å¿ƒé½‹æ©‹ã€é“é “å €æœ€å¾Œè—¥å¦ã€æœé£¾æ¡è²·ã€‚</li></ul></div>
        </div>

        <div class="itinerary-accordion" style="border-bottom: 1px solid #eee;">
            <div class="accordion-header" onclick="toggleAcc(this)">ğŸ“… 4/16 (å››) Day 6 æ­¸é€” <span>â–¼</span></div>
            <div class="accordion-content"><ul><li>11:00 å‰é£¯åº—é€€æˆ¿ä¸¦å¯„å­˜è¡Œæã€‚</li><li>é›£æ³¢æœ€å¾Œç¾é£Ÿè¡Œç¨‹ã€‚</li><li>23:35 é—œè¥¿æ©Ÿå ´ GK 57 èµ·é£› â” 01:30(+1) æŠµé”å°åŒ—ã€‚</li></ul></div>
        </div>
    </div>

    <!-- åˆ†é  2: è¨˜å¸³ -->
    <div id="expenses" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:25px; font-size:2.5rem; font-weight:700;">å…±æœ‰è¨˜å¸³</h1>
        <div class="glass-card">
            <h4 style="margin-top: 0; color: var(--accent-green); font-size: 1.2rem;">â• æ–°å¢æ”¯å‡º</h4>
            <div class="input-group">
                <input type="text" id="tabExpItem" class="custom-input" placeholder="é …ç›®">
                <input type="number" id="tabExpAmount" class="custom-input" placeholder="é‡‘é¡ (Â¥)">
                <select id="tabExpPayer" class="custom-input" style="flex: 0.5;"><option value="æˆ‘">æˆ‘</option><option value="æ—…ä¼´">æ—…ä¼´</option></select>
                <button class="action-btn" style="width: auto;" onclick="addExpenseTab(this)">ç´€éŒ„æ¬¾é …</button>
            </div>
        </div>
        <div class="glass-card settle-card"><h4 style="margin-top: 0; font-size: 1.2rem;">ğŸ“Š çµç®—å½™æ•´</h4><div id="settlementInfo">è¨ˆç®—ä¸­...</div></div>
        <div id="expenseList" style="padding:0; margin-top:20px;"></div>
    </div>

    <!-- åˆ†é  4: äº¤é€šå·¥å…· (å®Œæ•´å…§å®¹) -->
    <div id="transport" class="page-container">
        <h1 style="color:var(--primary-pink); margin-bottom:25px; font-size:2.5rem; font-weight:700;">äº¤é€šå·¥å…·</h1>
        
        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">âœˆï¸ å—æµ·é›»éµ (æ©Ÿå ´å¾€è¿”) <span>â–¼</span></div><div class="accordion-content">
            <div class="link-group">
                <a href="https://kensaku.nankai.co.jp/tc/pc/N1" target="_blank" class="transport-btn btn-timetable">ğŸ•’ æ™‚åˆ»è¡¨</a>
                <a href="https://www.howto-osaka.com/tc/access-timetable/" target="_blank" class="transport-btn btn-airport">âœˆï¸ æ©Ÿå ´ç™¼è»Š</a>
                <a href="https://www.nankai.co.jp/tc_railway/traffic/railmap.html" target="_blank" class="transport-btn btn-routemap">ğŸ—ºï¸ è·¯ç·šåœ–</a>
            </div>
            <p>é€£æ¥é—œè¥¿æ©Ÿå ´èˆ‡å¤§é˜ªé›£æ³¢ï¼Œæ˜¯å…¥å¢ƒæœ€å¿«é€Ÿã€æœ€ç†±é–€çš„é¸æ“‡ã€‚</p>
        </div></div>

        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸš‡ å¤§é˜ª Metro (å¸‚å…§äº¤é€š) <span>â–¼</span></div><div class="accordion-content">
            <div class="link-group">
                <a href="https://metronine.osaka/tw/line-departure/" target="_blank" class="transport-btn btn-airport">ğŸ•˜ é¦–/æœ«ç­è»Š</a>
                <a href="https://metronine.osaka/tw/fullpage-course/" target="_blank" class="transport-btn btn-routemap">ğŸ—ºï¸ è·¯ç·šåœ–</a>
            </div>
            <p>å¸‚å€æ ¸å¿ƒæ—…éŠå¿…å‚™ï¼Œå¾¡å ‚ç­‹ç·šå¯ç›´é”æ¢…ç”°ã€é›£æ³¢ã€å¤©ç‹å¯ºã€‚</p>
            <div class="metro-embed-container"><iframe src="https://metronine.osaka/tw/fullpage-course/"></iframe></div>
        </div></div>

        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸš† JR è¥¿æ—¥æœ¬ (è·¨åŸ/HARUKA) <span>â–¼</span></div><div class="accordion-content">
            <div class="link-group"><a href="https://www.westjr.co.jp/global/tc/timetable/" target="_blank" class="transport-btn btn-timetable">ğŸ•’ æ™‚åˆ»è¡¨</a></div>
            <p>æ­ä¹˜æ©Ÿå ´å¿«ç·š HARUKA å‰å¾€äº¬éƒ½æˆ–è·¨åŸå¸‚é•·é€”ç§»å‹•é¦–é¸ã€‚</p>
        </div></div>

        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸšƒ é˜ªæ€¥é›»éµ (äº¬éƒ½/ç¥æˆ¶) <span>â–¼</span></div><div class="accordion-content">
            <div class="link-group"><a href="https://rail.hankyu-railway.co.jp/station/" target="_blank" class="transport-btn btn-timetable">ğŸ•’ æ™‚åˆ»è¡¨</a></div>
            <p>å¾æ¢…ç”°ï¼ˆå¤§é˜ªä¸­å¿ƒï¼‰å‰å¾€äº¬éƒ½æ²³åŸç”ºæˆ–åµå±±æœ€åˆ’ç®—çš„éµè·¯ã€‚</p>
        </div></div>

        <div class="transport-accordion"><div class="accordion-header" onclick="toggleAcc(this)">ğŸµ äº¬é˜ªé›»è»Š (äº¬éƒ½è§€å…‰) <span>â–¼</span></div><div class="accordion-content">
            <div class="link-group"><a href="https://www.keihan.co.jp/travel/tw/trains/timetable.html" target="_blank" class="transport-btn btn-timetable">ğŸ•’ æ™‚åˆ»è¡¨</a></div>
            <p>å‰å¾€äº¬éƒ½ä¼è¦‹ç¨»è·å¤§ç¤¾ã€æ¸…æ°´å¯ºã€ç¥‡åœ’æœ€æ–¹ä¾¿çš„è§€å…‰è·¯ç·šã€‚</p>
        </div></div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAdafgqoTVQtcRsgdHCBLWKgsrzg8rWy18", authDomain: "japan-1cac5.firebaseapp.com", projectId: "japan-1cac5", storageBucket: "japan-1cac5.firebasestorage.app", messagingSenderId: "673729211706", appId: "1:673729211706:web:4958ffe5ba6d15fac63403", databaseURL: "https://japan-1cac5-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const memoRef = database.ref('memos'), expenseRef = database.ref('expenses');

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
        function showPage(pId) {
            document.querySelectorAll('.page-container').forEach(p => p.classList.remove('active'));
            document.getElementById(pId).classList.add('active');
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('current'));
            const idMap = {'home':0, 'itinerary':1, 'expenses':2, 'map':3, 'transport':4};
            document.getElementById('sidebar').children[idMap[pId]].classList.add('current');
            if (document.getElementById('sidebar').classList.contains('active')) toggleMenu();
        }
        function toggleAcc(h) { const c = h.nextElementSibling; c.classList.toggle('active'); h.querySelector('span').innerText = c.classList.contains('active') ? 'â–²' : 'â–¼'; }
        
        function addMemo() { const i = document.getElementById('memoInput'); if(i.value) { memoRef.push().set({ text: i.value }); i.value = ''; } }
        memoRef.on('value', s => {
            const l = document.getElementById('memoList'); l.innerHTML = '';
            s.forEach(c => { l.innerHTML += `<li class="list-card"><span>${c.val().text}</span><button class="del-btn" onclick="database.ref('memos/${c.key}').remove()">âœ•</button></li>`; });
        });

        function convertCurrency(src) {
            const jpy = document.getElementById('inputJPY'), twd = document.getElementById('inputTWD'), r = parseFloat(document.getElementById('exchangeRate').value) || 0;
            if(src==='JPY') twd.value = jpy.value ? (parseFloat(jpy.value) * r).toFixed(0) : "";
            else jpy.value = twd.value ? (parseFloat(twd.value) / r).toFixed(0) : "";
        }

        function addExpenseHome(b) {
            const item = document.getElementById('homeExpItem').value, amt = document.getElementById('homeExpAmount').value, payer = document.getElementById('homeExpPayer').value;
            if (item && amt) {
                expenseRef.push().set({ item, amt: parseFloat(amt), payer, time: Date.now() });
                document.getElementById('homeExpItem').value = ''; document.getElementById('homeExpAmount').value = '';
                b.innerText = "å·²ç´€éŒ„ï¼"; setTimeout(() => b.innerText = "ç´€éŒ„", 1000);
            }
        }
        function addExpenseTab(b) {
            const item = document.getElementById('tabExpItem').value, amt = document.getElementById('tabExpAmount').value, payer = document.getElementById('tabExpPayer').value;
            if (item && amt) {
                expenseRef.push().set({ item, amt: parseFloat(amt), payer, time: Date.now() });
                document.getElementById('tabExpItem').value = ''; document.getElementById('tabExpAmount').value = '';
                b.innerText = "æˆåŠŸï¼"; setTimeout(() => b.innerText = "ç´€éŒ„æ¬¾é …", 1000);
            }
        }
        expenseRef.on('value', s => {
            const l = document.getElementById('expenseList'), sb = document.getElementById('settlementInfo');
            l.innerHTML = ''; let me = 0, fr = 0;
            s.forEach(c => {
                const d = c.val(); if(d.payer==="æˆ‘") me+=d.amt; else fr+=d.amt;
                l.innerHTML += `<div class="list-card"><div><strong>${d.item}</strong> Â¥${d.amt} (${d.payer})</div><button class="del-btn" onclick="database.ref('expenses/${c.key}').remove()">âœ•</button></div>`;
            });
            const diff = (me - fr) / 2;
            sb.innerHTML = `<strong>${diff > 0 ? 'æ—…ä¼´æ‡‰ä»˜ä½ ' : (diff < 0 ? 'ä½ æ‡‰ä»˜æ—…ä¼´' : 'å…©æ¸…')}ï¼šÂ¥${Math.abs(diff).toFixed(0)}</strong>`;
        });

        const API_KEY = '02462ec6be3770531a65ab94c8cf93cb';
        async function fetchWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=Osaka&appid=${API_KEY}&units=metric&lang=zh_tw`);
                const data = await res.json();
                if(data.cod === "200") {
                    const current = data.list[0];
                    document.getElementById('tempMain').innerText = Math.round(current.main.temp) + 'Â°';
                    document.getElementById('weatherDesc').innerText = current.weather[0].description;
                    document.getElementById('tempMax').innerText = Math.round(current.main.temp_max) + 'Â°';
                    document.getElementById('tempMin').innerText = Math.round(current.main.temp_min) + 'Â°';
                    document.getElementById('tempFeels').innerText = Math.round(current.main.feels_like) + 'Â°';
                    document.getElementById('weatherAlerts').innerText = current.weather[0].main.toLowerCase().includes('rain') ? "æœ‰é›¨ï¼Œè¨˜å¾—å¸¶å‚˜ â˜”" : "æ°£æº«èˆ’é© âœ¨";
                }
            } catch (e) { console.error("å¤©æ°£å¤±æ•—:", e); }
        }

        window.onload = () => {
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('zh-TW', { month: 'long', day: 'numeric', weekday: 'long' });
            fetchWeather();
        };
        function mapsJump() { const q = document.getElementById('mapSearch').value; if(q) window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank'); }
        function homeSearchJump() { const q = document.getElementById('homeSearch').value; if(q) window.open(`https://www.google.com/maps/search/${encodeURIComponent(q)}`, '_blank'); }
    </script>
</body>
</html>

